# Changelog

All notable changes to this project will be documented in this file.

## [Unreleased]
- Introduce PortfolioThemeUpdate table and CRUD helpers for theme update timelines
- Add access paths for Portfolio Theme Updates with toolbar, context menu, keyboard shortcut, and tab navigation
- Add deviation analytics with tolerance controls to Portfolio Theme valuation table
- Add description and optional institution link to Portfolio Themes with migration 012
- Align Composition table headers with data columns and add per-instrument notes pop-up in Portfolio Theme details
- Enforce consistent 2000-character limit for portfolio asset notes
- Remove Notes column from Portfolio Theme valuation table and align totals under Current Value
- Ensure Portfolio Theme valuation shows all instruments, resolves FX via identity and inversion, and keeps table visible for zero totals
- Share FXConversionService using latest flagged rates for consistent CHF conversion across views
- Log warning when FX rate_date cannot be parsed and fallback is used
- Handle valuation event serialization errors with explicit logging
- Fix Portfolio Themes list not updating Total Value after valuations load
- Add Total Value and Instruments columns with sortable headers to Portfolio Themes list
- Fix theme total value spinner by loading valuations sequentially
- Optimize portfolio theme fetch to count instruments without per-row queries
- Add on-demand Portfolio Valuation service with refreshable theme snapshot
- Include instrument notes in valuation snapshot output
- Fix valuation to aggregate instrument holdings across the entire estate
- Require archiving a theme before deletion with archive-and-delete alert flow
- Polish Portfolio Theme maintenance layouts and add instrument notes field
- Normalize empty instrument notes to nil in theme detail editor and add-instrument sheet
- Fix Portfolio Theme allocation edits not persisting and log updates
- Fix instrument notes edits not saving in theme detail view
- Present valuation status and notes in dedicated columns to avoid confusion
- Introduce PortfolioThemeAsset table linking themes to instruments with target allocations
- Add PortfolioTheme entity with CRUD UI and migration 010
- Fix Portfolio Theme creation to persist database records and improve new theme editor layout
- Remove Portfolio Themes feature flag; navigation and Theme Status settings are always visible
- Navigate from Portfolio Themes list to detail view with keyboard, icon, or context menu; archived themes open read-only
- Present Portfolio Theme details in modal window with aligned Composition and Valuation sections
- Disable Performance and Rebalancing links in sidebar
- Ensure new theme popup accepts a theme code and disable Save until required fields are valid
- Introduce HealthCheckRegistry for startup diagnostics with per-check configuration
- Expose health check summary and toggle in Settings with link to detailed report
- Show executed health checks with detailed results in dedicated window and verify database file presence
- Add SQL example for PortfolioThemeStatus color validation and require migrations to include the CHECK constraint
- Document constraints and indexes for `PortfolioThemeAsset` in portfolio module spec
- Clarify `current_value` sourcing, on-demand refresh, caching, and failure modes in Portfolio Module specification
- Document attachment limits and access controls in portfolio module spec
- Document Portfolio module endpoints with status codes, pagination, versioning, and standard error envelope
- Document migration dependencies and guidelines for Portfolio Module integration
- Update parser mapping docs to schema version 4.26 and document maintenance for future schema changes
- Cache institution name in Position form to avoid repeated lookups
- Generate docs manifest and enforce updates via CI workflow
- Add troubleshooting guide and fix README link path
- Deduplicate version history entries in README
- Consolidate UI concept notes into the main UI/UX design guide
- Replace Database Management & Backups section with link to consolidated database documentation
- Clarify PortfolioThemeStatus scope, color code validation, and default handling in portfolio module docs
- Introduce PortfolioThemeStatus table with default statuses and basic management UI
- Fix SQLITE_TRANSIENT compile error in PortfolioThemeStatus database helpers
- Wrap PortfolioThemeStatus insert/update operations in transactions and log sqlite3_exec errors to preserve default integrity
- Harden PortfolioThemeStatus update transaction to rollback on commit failure
- Surface Theme Status save failures and handle default restoration errors
- Log default restoration as info to match OSLog levels
- Add search bar to Positions view to filter positions across all fields
- Disable Generate Full Instrument Report button with hover notice in Database Management view
- Expand Backup & Restore log by default in Database Management view
- Add button to validate Instruments in Database Management view
- Temporarily disable Reference and Transaction data backup and restore buttons
- Add configurable startup health checks with UI summary
- Log individual startup health check results and ensure database file check passes by reading the path lazily
- Sync validation status of class and subclass targets from findings and purge zero-target data
- Skip validation for asset classes without target allocation and clear related findings
- Enlarge validation details modal and add close button
- Add totals row and validation details modal to Asset Allocation view
- Move portfolio total validation from class editor to main dashboard and show validation badges for asset classes
- Persist class-level validation findings and show them via "Why?" in target edit panel
- Replace faulty allocation validation triggers with non-blocking versions and update validation_status
- Convert Edit Targets panel into resizable floating window with scrollable content
- Show bold, left-aligned "Asset Allocation for <Class>" title in target edit panel
- Add validation status column with traffic-light icons and deviation bars in Asset Allocation table
- Fix failed ClassTargets/SubClassTargets upserts so edited targets persist
- Ensure backup routines include TargetChangeLog and full reference data
- Fix backup script to verify and close database before deleting corrupt backup
- Remove legacy Asset Allocation view and navigation link
